.. vim: syntax=rst

PID控制器参数整定
==========================================
算法固然重要，但是参数重要性一点也不低于算法本身，同样的算法如果PID的参数调的不好，实际的效果就是天壤之别了，所以这个章节主要对参数的整定进行讲解。

.. image:: ../media/show_line1.png
   :align: center

参数整定曲线图

以上是四组不同的参数对实际值的影响，其中蓝色的线为目标值绿色的线为实际值，但是在不同参数下却表现的大不相同，在曲线上已经变现的很明显了；
如果曲线的走势就表示电机的速度变化，可想而知，哪个参数好哪个参数不好，那么这个么重要的参数应该怎样整定呢？整定参数都与什么有关系呢？

它是根据被控过程的特性确定 PID 控制器的比例系数、积分时间和微分时间的大小；PID控制器参数整定的方法有很多，主要分为两大类理论计算整定方法和
工程整定法也叫作经验法；其中第一种是理论计算整定法主要是建立数学模型然后根据数学模型，经过理论的计算来确定最终的控制器参数，这种方法是在所有的情况都是理想的，
经过这种方法调出来的参数是不可以直接使用的，毕竟理想化的参数考虑的太少，只能当做一个参考还需要根据实际情况修改；

第二种是工程整定方法，它主要是依赖于工程中的经验，直接在实际的控制系统的实验中进行，方法简单容易掌握，被广泛使用；

在实际的应用中用到的最多的应该就要属经验法（工程整定法），因为不同的控制系统的实际情况都是不一样的，除了理论公式一致以外其它的完全不同。
所以就需要懂得理论并付诸于实践，才能使控制系统达到好的效果。

.. image:: ../media/pidgif.gif
   :align: center

先看上图中PID曲线动态图，这个图只描述了算法中的一部分参数，可以做来参考。

**试凑法**

采样周期的选择，要根据所设计的系统的具体情况，用试凑的方法，在试凑过程中根据各种合理的建议来预选采样周期，
多次试凑，选择性能较好的一个作为最后的采样周期。早整定参数时必须要认真的观察系统的相应情况，根据系统的响应情况来调整参数。
在调节参数时应该知道各种参数调节的特点，才能有的放矢；

- 比例调节作用特点：调节作用快，系统一出现偏差，调节器立即将偏差放大输出；
- 积分调节作用特点：积分调节作用的输出变化与输入偏差的积分成正比，积分调节作用的输出不仅取决于偏差的大小，还取决于偏差存在的时间，只要有偏差存在,
  尽管偏差可能很小，但它存在的时间越长，输出信号就越大，只有消除偏差，输出才停止变化；
- 微分调节作用特点：微分调节的输出是与被调量的变化率成正比，微分调节越大，越能提前响应，但是也会将不必要的偏差放大；

1. 先是比例（P），再积分（I），最后是微分（D）
#. 调试时，将PID参数置于影响最小的位置，即P最大，I最大，D最小；
#. 按纯比例系统整定比例度，使其得到比较理想的调节过程曲线，然后再把比例度放大1.2倍左右，将积分时间从大到小改变，使其得到较好的调节过程曲线；
#. 最后在这个积分时间下重新改变比例度，再看调节过程曲线有无改善；
#. 如有改善，可将原整定的比例度减少，改变积分时间，这样多次的反复，就可得到合适的比例度和积分时间；
#. 如果在外界的干扰下系统稳定性不好，可把比例度和积分时间适当增加一些，使系统足够稳定；
#. 将整定好的比例度和积分时间适当减小，加入微分作用，以得到超调量最小、调节作用时间最短的调节过程。

**临界比例法**

临界比例法：适用于闭环控制系统里将调节器置于纯比例的作用下，从大到小逐渐改变调节器的比例度，并且得到等幅度的震荡过程就叫做临界比例度；

1. 将调节器的积分置于最大，微分置于0，比例度系数适当即可平衡一段时间，把系统投放到自动运行中。
#. 然后将比例逐渐增大，增大到产生等幅现象，并记录下等幅时的临界比例系数和两个波峰的时间间隔。
#. 根据记下的比例系数和周期，采用经验公式，计算调节器的参数。    

========== ========== ==================== =================
控制方法     Kp        Ki                   Kd               
========== ========== ==================== =================
P控制       δK / 2                                       
PI控制      δK / 2.2   Kp / (0.833 × TK)                   
PID控制     δK / 1.7   Kp / (0.5 × TK)      0.125 × TK × Kp        
========== ========== ==================== =================

**一般调节法**

这种方法针对一般的PID控制系统所以称之为一般调节法；其中Kp是加快系统响应速度，提高系统的调节精度；Ki用于消除稳态误差；Kd改善系统的稳态性能

.. 1. 确定比例系数
..    确定比例系数Kp 时，首先去掉PID 的积分项和微分项，可以令Ki=0、Kd=0，使之成为
..    纯比例调节。输入设定为系统允许输出最大值的60％～70％，比例系数Kp 由0 开始逐渐增
..    大，直至系统出现振荡；再反过来，从此时的比例系数Kp 逐渐减小，直至系统振荡消失。
..    记录此时的比例系数Kp，设定PID 的比例系数Kp 为当前值的60％～70％。
.. #. 确定积分系数
..    比例系数Kp 确定之后，设定一个较大的积分时间常数Ki，然后逐渐减小Ki，直至系统出现
..    振荡，然后再反过来，逐渐增大Ki，直至系统振荡消失。记录此时的Ki，设定PID 的积分
..    时间常数Ki 为当前值的150％～180％。
.. #. 确定微分系数
..    微分时间常数Kd 一般不用设定，为0 即可，此时PID 调节转换为PI 调节。如果需要设定，
..    则与确定Kp 的方法相同，取不振荡时其值的30％。
.. #. 系统空载、带载联调
..    对 PID 参数进行微调，直到满足性能要求。

a. 在输出不振荡时，增大比例增益P。
b. 在输出不振荡时，减小积分时间常数Ti。
c. 在输出不振荡时，增大微分时间常数Td。

（它们三个任何谁过大都会造成系统的震荡。）

一般步骤为：
 
a. 确定比例增益P ：确定比例增益P 时，首先去掉PID的积分项和微分项，一般是令Ti=0、Td=0（具体见PID的参数设定说明），使PID为纯比例调节。
   输入设定为系统允许的最大值的60%~70%，由0逐渐加大比例增益P，直至系统出现振荡；再反过来，从此时的比例增益P逐渐减小，直至系统振荡消失，记录此时的比例增益P，设定PID的比例增益P为当前值的60%~70%。比例增益P调试完成。
b. 确定积分时间常数Ti比例增益P确定后，设定一个较大的积分时间常数Ti的初值，然后逐渐减小Ti，直至系统出现振荡，之后在反过来，逐渐加大Ti，
   直至系统振荡消失。记录此时的Ti，设定PID的积分时间常数Ti为当前值的150%~180%。积分时间常数Ti调试完成。
c. 确定积分时间常数Td 积分时间常数Td一般不用设定，为0即可。若要设定，与确定 P和Ti的方法相同，取不振荡时的30%。
d. 系统空载、带载联调，再对PID参数进行微调，直至满足要求：理想时间两个波，前高后低4比1。

**采样周期选择**

采样周期该怎么选择？采样周期越短控制的效果越接近于连续，对于大多数算法缩短采样周期可使控制回路性能改善，但采样周期缩短时，频繁的采样必然会占用较多的计算工作时间，
同时也会增加计算的负担，而对有些变化缓慢的受控对象无需很高的采样频率即可满意地进行跟踪，过多的采样反而没有多少实际意义。

以一个轮子的转动为例，根据耐奎斯特采样定理可知：假设这个伦斯以每秒45度来转动，那么每个轴返回原位需要8秒（采样周期），那如果我们在8、16、
24秒时用相机拍照是不是拍到的照片都是静止不动的？这是因为在采样的周期内，车轮旋转的证书周期都会回到原位，不论旋转方向如何都会回到原位；如果
现在减少拍照时间，每4秒钟拍一张照片则会在照片中发现轮子正在旋转，但是不能区分旋转方向。如果3秒钟拍一张照片那么无论是顺时针还是逆时针都可以从照片中
观察到轮子的相位变化。这就是Nyquist-Shannon采样定理，我们希望同时看到轮子的旋转和相位变化，采样周期要小于整数周期的1/2，采样的频率应该大于原始频率的2倍。

.. image:: ../media/lunzi.png
   :align: center

以上的调参方法只是一些工程上一些普遍的方法，但是调参时更注重的应该是原理和影响因素，不同的控制系统因素不同。
例如电机控速系统，影响参数的有电源电压电流还有反馈的精度，具体参数要根据实际具体调整，才能更有效。






